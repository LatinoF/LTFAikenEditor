<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LTF Aiken Question Creator</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      .scrollbar-thin::-webkit-scrollbar {
          width: 4px;
      }
      .scrollbar-thin::-webkit-scrollbar-thumb {
          background-color: #a0aec0;
          border-radius: 8px;
      }
      .max-w-8xl{
        max-width: 75%;
      }
      body {
            font-family: 'Nunito', sans-serif;
        }
  </style>

</head>
<body class="p-6 bg-gray-100">
    <div class="max-w-8xl mx-auto flex space-x-6">
        <div class="w-3/5 bg-white p-6 shadow-lg rounded-xl max-h-fit overflow-y-auto">
            <h1 class="text-2xl font-bold mb-4">LTF Aiken Question Creator</h1>
            
            <label class="block mb-2">Domanda:</label>
            <input id="questionText" class="w-full border p-2 rounded mb-4" placeholder="Corpo della domanda"></input>
            
            <label class="block mb-2">Opzioni di risposta:</label>
            <div id="answers" class="mb-4 space-y-2">
              <div class="flex items-center space-x-2">
                  <input type="radio" name="correctAnswer" value="A" checked>
                  <div class="relative w-full">
                      <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">A:</span>
                      <input type="text" class="w-full border p-2 pl-8 rounded" placeholder="Risposta A" value="" required>
                  </div>
              </div>
              <div class="flex items-center space-x-2">
                  <input type="radio" name="correctAnswer" value="B">
                  <div class="relative w-full">
                      <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">B:</span>
                      <input type="text" class="w-full border p-2 pl-8 rounded" placeholder="Risposta B" value="">
                  </div>
              </div>
              <div class="flex items-center space-x-2">
                  <input type="radio" name="correctAnswer" value="C">
                  <div class="relative w-full">
                      <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">C:</span>
                      <input type="text" class="w-full border p-2 pl-8 rounded" placeholder="Risposta C" value="">
                  </div>
              </div>
              <div class="flex items-center space-x-2">
                  <input type="radio" name="correctAnswer" value="D">
                  <div class="relative w-full">
                      <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">D:</span>
                      <input type="text" class="w-full border p-2 pl-8 rounded" placeholder="Risposta D" value="">
                  </div>
              </div>
            </div>
            
            <button onclick="addQuestion()" class="px-2 py-2 bg-green-500 text-white rounded flex items-center hover:bg-green-600 hover:text-gray-100 transition duration-200">
              <span class="material-icons">add</span> Aggiungi Domanda
          </button>
        </div>
        
        <div class="w-2/5 bg-white p-6 shadow-lg rounded-xl h-[94vh] flex flex-col">
          <div class="flex justify-between items-center mb-4">
              <h1 class="text-xl font-bold">Database</h1>
              <div class="flex space-x-2">
                  <button id="clearCacheButton" class="px-2 py-2 bg-red-500 text-white rounded flex items-center hover:bg-red-600 hover:text-gray-100 transition duration-200">
                    <span class="material-icons">delete</span> Cancella DB
                </button>
              
                  <button onclick="downloadAiken()" class="px-2 py-2 bg-blue-700 text-white rounded flex items-center hover:bg-blue-600 hover:text-gray-200 transition duration-200">
                      <span class="material-icons">download</span> Scarica DB
                  </button>
              </div>
          </div>
          <div class="flex-1 overflow-y-auto scrollbar-thin">
              <ul id="questionList" class="space-y-2 mr-2"></ul>
          </div>
      </div>
      
    </div>

    <div id="InfoModalContainer"></div>

    <div id="customAlert" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-white rounded-lg p-6 max-w-sm w-full">
            <h2 class="text-lg font-bold mb-4 flex items-center">
                <span class="material-icons mr-2 text-orange-400">warning</span> Attenzione
            </h2>
            <p id="alertMessage" class="mb-4">Completare tutti i campi</p>
            <div class="flex justify-end">
                <button id="closeAlert" class="flex items-center px-2 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                    <span class="material-icons mr-2">check</span> OK
                </button>
            </div>
        </div>
    </div>
    

    <div id="confirmModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
      <div class="bg-white rounded-lg p-6 max-w-sm w-full">
        <h2 class="text-lg font-bold mb-4 flex items-center">
            <span class="material-icons mr-2 text-orange-400">warning</span> Attenzione
        </h2>
          <p id="confirmMessage" class="mb-4">Placeholder Testo Notifica</p>
          <div class="flex justify-end">
            <button id="cancelConfirm" class="px-2 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 mr-2 flex items-center">
                <span class="material-icons">close</span> Annulla
            </button>
            
            <button id="confirmAction" class="px-2 py-2 bg-red-500 text-white rounded flex items-center hover:bg-red-600 hover:text-gray-100 transition duration-200">
                <span class="material-icons">delete</span> Cancella DB
            </button>
        </div>
        
      </div>
  </div>
  

    <script>

        function saveToCookies() {
            document.cookie = `questions=${encodeURIComponent(JSON.stringify(questions))}; path=/; max-age=86400`;
        }
        
        function loadFromCookies() {
            let cookieData = document.cookie.split('; ').find(row => row.startsWith('questions='));
            if (cookieData) {
                questions = JSON.parse(decodeURIComponent(cookieData.split('=')[1]));
                updateQuestionList();
            }
        }
        
        let questions = [];
        loadFromCookies();
        
        function showAlert(message) {
        const alertMessage = document.getElementById('alertMessage');
        const customAlert = document.getElementById('customAlert');
        alertMessage.textContent = message;
        customAlert.classList.remove('hidden');
        }

        function addQuestion() {
            let questionText = document.getElementById("questionText").value;
            let answerElements = document.querySelectorAll("#answers .flex");
            let answers = [];
            let correctAnswer = "";
            
            answerElements.forEach((el, i) => {
                let input = el.querySelector("input[type='text']");
                let radio = el.querySelector("input[type='radio']");
                answers.push(input.value);
                if (radio.checked) correctAnswer = String.fromCharCode(65 + i);
            });
            
            if (!questionText || answers.some(a => !a)) {
                showAlert("Completare tutti i campi");
                return;
            }
            
            questions.push({ text: questionText, answers, correctAnswer });
            updateQuestionList();
            saveToCookies();
            
            
            document.getElementById("questionText").value = "";
            answerElements.forEach((el, i) => {
                el.querySelector("input[type='text']").value = "";
                el.querySelector("input[type='radio']").checked = i === 0;
            });
        }

    
    document.getElementById('closeAlert').addEventListener('click', function() {
        document.getElementById('customAlert').classList.add('hidden');
    });
        function deleteQuestion(index) {
            questions.splice(index, 1);
            updateQuestionList();
            saveToCookies();
        }

        function updateQuestionList() {
            let list = document.getElementById("questionList");
            list.innerHTML = "";
            questions.forEach((q, index) => {
                let li = document.createElement("li");
                li.className = "p-2 bg-gray-200 rounded flex justify-between items-center";
                li.innerHTML = `${q.text.replace(/\n/g, "<br>")} 
                    <div class="flex space-x-1">
                        <button onclick="editQuestion(${index})" class='px-2 py-1 bg-blue-500 text-white rounded flex items-center hover:bg-blue-600 hover:text-gray-200 transition duration-200'>
                            <span class="material-icons">edit</span>
                        </button>
                        <button onclick="deleteQuestion(${index})" class='px-2 py-1 bg-red-500 text-white rounded flex items-center hover:bg-red-600 hover:text-gray-200 transition duration-200'>
                            <span class="material-icons">delete</span>
                        </button>
                    </div>`;
                list.appendChild(li);
            });
        }
        
        function editQuestion(index) {
            let q = questions[index];
            document.getElementById("questionText").value = q.text;
            let answerElements = document.querySelectorAll("#answers .flex");
            q.answers.forEach((answer, i) => {
                let input = answerElements[i].querySelector("input[type='text']");
                let radio = answerElements[i].querySelector("input[type='radio']");
                input.value = answer;
                radio.checked = q.correctAnswer === String.fromCharCode(65 + i);
            });
            questions.splice(index, 1);
            updateQuestionList();
            saveToCookies();
        }
        
        function clearQuestions() {
            questions = [];
            updateQuestionList();
            saveToCookies();
        }
        
        function downloadAiken() {
            let aikenText = questions.map(q => `${q.text}\n${q.answers.map((a, i) => `${String.fromCharCode(65 + i)}. ${a}`).join('\n')}\nANSWER: ${q.correctAnswer}`).join("\n\n");
            let blob = new Blob([aikenText], { type: "text/plain" });
            let a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "Database AIKEN.txt";
            a.click();
        }

        let actionToConfirm = null; 

        function showConfirmModal(message, action) {
            const confirmMessage = document.getElementById("confirmMessage");
            const confirmModal = document.getElementById("confirmModal");
            
            confirmMessage.textContent = message; 
            actionToConfirm = action; 
            confirmModal.classList.remove("hidden"); 
        }

        document.getElementById("cancelConfirm").addEventListener("click", function() {
            const confirmModal = document.getElementById("confirmModal");
            confirmModal.classList.add("hidden"); 
        });

        document.getElementById("confirmAction").addEventListener("click", function() {
            if (actionToConfirm) {
                actionToConfirm();
            }
            const confirmModal = document.getElementById("confirmModal");
            confirmModal.classList.add("hidden"); 
        });

        
        document.getElementById("clearCacheButton").addEventListener("click", function() {
            showConfirmModal("Sei sicuro di voler cancellare il database?", clearQuestions);
        });
    </script>
    <script src="modular/info_modal.js"></script>
</body>
</html>